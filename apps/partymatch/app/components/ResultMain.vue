<script setup>
import InfoPopup from './InfoPopup.vue';
import { ElectionButton } from '@election/ui/vue';

const props = defineProps({
	matchAnswers: Array,
	partyAnswers: Array,
	allPartiesData: Array,
	selectedParty: { type: Object, default: null },
	partyLogo: String,
	partyName: String,
	matchScore: Number,
});

const emit = defineEmits(['reset', 'update:matchScore']);
const resetQuiz = () => {
	emit('reset');
};
const showAll = ref(false);
const showAllParty = () => {
	showAll.value = !showAll.value;
};
const isInfoPopupVisible = ref(false);

const projects = [
	{
		href: 'https://parliamentwatch.wevis.info/',
		title: 'ดูผลโหวตในสภาฯ ชุดที่ผ่านมา',
		imgSrc: '/img/og-project.png',
	},
	{
		href: 'https://election69.wevis.info/',
		title: 'ส่องนโยบายพรรค เลือกตั้ง 69',
		imgSrc: '/img/og-project.png',
	},
];
const saveIcon =
	'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.4 11.7001C20.8971 11.7001 21.3 12.103 21.3 12.6001L21.143 13.3968V13.516V13.6084C21.2133 13.8865 21.1261 14.1007 21.143 14.3837L21.1629 14.7212L21.1834 15.0587C21.1898 15.1645 21.217 15.2832 21.2778 15.4178L21.4295 15.7553L21.5819 16.0928C21.7683 16.5065 21.8067 16.9564 21.6703 17.4012L21.5672 17.7387L21.4635 18.0762C21.4463 18.1324 21.4467 18.1768 21.4629 18.2315L21.6633 18.9065C21.7409 19.168 21.7795 19.5771 21.5133 19.953C21.267 20.3008 20.9009 20.4137 20.6696 20.4546L19.8944 20.5917C19.5932 20.6448 19.2992 20.6736 19.0149 20.6743L18.6774 20.6755L18.3399 20.6761C18.1531 20.6765 17.9657 20.6887 17.778 20.713L17.4405 20.7569L17.103 20.8003C16.7532 20.8454 16.405 20.8173 16.0664 20.7212L15.7289 20.6251L15.3914 20.5296C15.1821 20.4701 14.9732 20.4167 14.7645 20.3696L14.0895 20.2173C13.9479 20.1853 13.8104 20.175 13.6746 20.1844L12.9996 20.2313C12.7924 20.2457 12.585 20.2662 12.3774 20.2928L11.7024 20.3796C11.4164 20.4163 11.1292 20.4231 10.8422 20.4007L10.1672 20.3479C10.1428 20.346 10.0929 20.3467 10.0002 20.3983L9.66273 20.5864L9.32523 20.7739C8.95593 20.9794 8.53863 21.0813 8.09769 21.0247L7.42269 20.938C7.30055 20.9223 7.17832 20.9272 7.05179 20.9544L6.37679 21.0997C6.0935 21.1606 5.80754 21.1928 5.52015 21.1952L5.18265 21.1981L4.84515 21.2005C4.3803 21.2043 3.96023 21.0325 3.62874 20.7165L3.37913 20.478L3.12894 20.2395C2.82978 19.9542 2.63223 19.5979 2.54945 19.1925L2.4803 18.855L2.41175 18.5175C2.31182 18.0278 2.43242 17.5681 2.67835 17.1803L2.8928 16.8428L3.04046 16.6096L2.74749 16.06C2.5913 15.7664 2.47646 15.459 2.41234 15.1395L2.34495 14.802L2.27698 14.4645C2.17759 13.969 2.3284 13.432 2.50843 12.9751L2.71234 12.4583C2.78042 12.0287 3.15129 11.7001 3.60003 11.7001C4.09709 11.7001 4.50003 12.103 4.50003 12.6001V12.8309L4.18304 13.6348C4.11173 13.8158 4.07389 13.9491 4.05648 14.0409C4.04734 14.0891 4.04568 14.1166 4.04534 14.127L4.1098 14.4481L4.17718 14.7856C4.20336 14.916 4.25345 15.0589 4.33656 15.2151L4.51644 15.5526L4.69573 15.8901C4.97579 16.4166 4.93302 16.9868 4.62659 17.4698L4.19886 18.1448C4.18884 18.1606 4.18299 18.1723 4.17952 18.18L4.31312 18.8327C4.32219 18.877 4.33717 18.9046 4.37113 18.937L4.62132 19.1755L4.85628 19.3999L5.16741 19.3981L5.50491 19.3952C5.66739 19.3939 5.8317 19.3759 5.99827 19.3401L6.67327 19.1948C6.99656 19.1253 7.32468 19.1106 7.65238 19.1526L8.32737 19.2393C8.33682 19.2406 8.36998 19.2457 8.44984 19.2012L8.78734 19.0132L9.12484 18.8257C9.4821 18.6268 9.88232 18.5199 10.3078 18.5532L10.6453 18.5796L10.9828 18.6065C11.1458 18.6193 11.3088 18.6152 11.4727 18.5942L12.1477 18.5075C12.39 18.4764 12.6328 18.4522 12.8754 18.4354L13.5504 18.3886C13.8646 18.3668 14.1773 18.3916 14.4856 18.4612L15.1606 18.6136C15.4018 18.668 15.643 18.7298 15.8836 18.7981L16.2211 18.8936L16.5586 18.9897C16.6699 19.0213 16.772 19.0278 16.8721 19.0149L17.2096 18.9716L17.5471 18.9276C17.8092 18.8938 18.0721 18.8767 18.3352 18.876L18.6727 18.8755L19.0102 18.8743C19.1757 18.8739 19.3658 18.8573 19.5815 18.8192L19.7508 18.7887L19.7373 18.7436C19.62 18.3485 19.6219 17.9427 19.7426 17.5489L19.8463 17.2114L19.9494 16.8739L19.9518 16.8651C19.9518 16.8651 19.9516 16.8632 19.9506 16.8593C19.9494 16.8546 19.9466 16.8454 19.9407 16.8323L19.7889 16.4948L19.6366 16.1573C19.4945 15.8421 19.4069 15.5105 19.3864 15.1665L19.3664 14.829L19.3459 14.4915C19.336 14.3245 19.3097 14.1553 19.2662 13.9835L19.1813 13.646L19.0957 13.3085C19.0592 13.1639 19.0157 12.9479 19.0424 12.7202C19.0719 12.4693 19.2308 12.0022 19.7614 11.8483L19.9881 11.7827L20.0297 11.7803C20.1427 11.7292 20.2679 11.7001 20.4 11.7001Z\" fill="white"/><path d="M16.3984 10.6617C16.5801 11.0103 16.5097 11.4229 16.2549 11.694L16.0352 12.1158C15.793 12.58 15.4209 13.0793 14.833 13.2682L14.252 13.4557L14.1504 14.108C14.0768 14.5801 13.8236 15.0841 13.2588 15.3219L12.6816 15.5651L12.5918 15.5992C12.1999 15.7371 11.8069 15.7012 11.458 15.5524L11.2998 15.4762L10.9873 15.3053L10.6738 15.1344C10.2584 14.908 9.96843 14.5507 9.82031 14.111L9.58496 13.4117C9.54205 13.2843 9.48641 13.1939 9.42578 13.1266L9.19922 12.8756L8.97363 12.6256C8.83732 12.4744 8.70597 12.339 8.58008 12.2203L8.5 12.1451L7.98437 11.8756C7.54377 11.6457 7.37281 11.1024 7.60254 10.6617C7.6113 10.645 7.6222 10.6289 7.63184 10.6129L7.64258 10.5514L7.89844 10.317C8.28959 9.95853 8.7433 10.0995 8.82129 10.1256C8.95217 10.1694 9.05012 10.2338 9.09473 10.2643C9.19689 10.3341 9.29666 10.4221 9.37793 10.4987L9.5957 10.7047L9.81445 10.9108C9.97981 11.0666 10.1455 11.2366 10.3105 11.4196L10.5361 11.6705L10.7617 11.9205C10.8711 12.0418 10.9654 12.1733 11.0479 12.3112L10.9717 11.9C10.8966 11.4906 10.95 11.0877 11.1084 10.7125L11.3936 10.0377C11.4148 9.98723 11.4111 9.96602 11.4053 9.94397L11.2266 9.26916C11.165 9.03768 11.1057 8.80546 11.0498 8.57385L10.8867 7.89807C10.7976 7.52856 10.8008 7.15328 10.8965 6.78577L11.0723 6.11096C11.1095 5.96813 11.1242 5.83035 11.1191 5.69592L11.1074 5.35803L11.0947 5.02112C11.0854 4.77234 11.0845 4.42592 11.0908 3.99182L11.1006 3.34729L11.1006 3.30041C11.1006 2.8034 11.503 2.40009 12 2.40002C12.4971 2.40002 12.9004 2.80336 12.9004 3.30041L12.9004 3.37366L12.8906 4.01819C12.8844 4.44352 12.886 4.75258 12.8936 4.95374L12.9062 5.29163L12.918 5.62952C12.9297 5.94483 12.8944 6.25716 12.8145 6.56409L12.6387 7.23889C12.6173 7.32101 12.6174 7.39608 12.6367 7.4762L12.7998 8.15198C12.8524 8.36996 12.9078 8.58818 12.9658 8.80627L13.1455 9.48108C13.2591 9.90863 13.2201 10.338 13.0518 10.7369L12.7666 11.4127C12.7352 11.4871 12.7348 11.5344 12.7422 11.5748L12.8037 11.9127L12.8623 12.2301C13.0548 12.0124 13.2942 11.8715 13.543 11.7916L13.9131 11.6735L14.248 11.566C14.2516 11.5627 14.2565 11.5589 14.2617 11.5533C14.3 11.5132 14.3623 11.4308 14.4395 11.2828L14.749 10.6891L14.8799 10.4381L15.1309 10.3082L15.1846 10.2799C15.6252 10.0504 16.1686 10.2213 16.3984 10.6617Z" fill="white"/> </svg>';
</script>

<template>
	<!-- Result -->
	<div class="bg-green-3 relative flex min-h-[calc(100vh-56px)] flex-col p-10">
		<div class="center flex flex-col items-center">
			<ResultCard
				:matchLogo="partyLogo"
				:matchName="partyName"
				:partyAnswers="partyAnswers"
				:matchAnswers="matchAnswers"
				:allPartiesData="allPartiesData"
				:selectedParty="selectedParty"
				:showAll="showAll"
				@update:matchScore="(score) => $emit('update:matchScore', score)"
			/>
			<button
				class="bg-bg text-b6 flex h-10 w-40 cursor-pointer items-center justify-center rounded-b-2xl p-4 pt-1 shadow-md hover:font-bold hover:shadow-none"
				@click="showAllParty"
			>
				{{ showAll ? 'ย่อ' : 'ดูลำดับทั้งหมด' }}
			</button>
		</div>

		<div class="section flex flex-col items-center gap-4 pt-8">
			<IconButton
				:buttonText="'Save ไป<span class=\'line-through\'>แฉ</span>แชร์ต่อ'"
				:buttonIcon="saveIcon"
			/>
			<button
				@click="resetQuiz"
				class="font-kondolar hover:bg-green-2 flex h-12 cursor-pointer flex-row items-center justify-center gap-4 rounded-full border-2 pr-6 pl-4 font-bold hover:border-3"
			>
				<svg
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					xmlns="http://www.w3.org/2000/svg"
				>
					<path
						d="M11.7495 1.31622C12.0166 0.999918 12.4894 0.960169 12.8059 1.22716C13.0689 1.44924 13.1411 1.81351 13.0045 2.11192L12.9916 2.20684L12.9864 2.24493L12.9776 2.28243L12.9407 2.43536C12.8461 2.82614 12.5454 3.06533 12.343 3.19649L11.8637 3.50704C11.7524 3.5792 11.6524 3.66174 11.5631 3.75489L11.3686 3.95821L11.1735 4.16153C11.0924 4.24615 11.0088 4.32824 10.9245 4.40938C11.0999 4.40391 11.2756 4.41753 11.4489 4.44806L12.2422 4.58751C12.4098 4.617 12.48 4.59862 12.4889 4.59571L13.0567 4.41056C13.5037 4.26503 13.9471 4.32969 14.3311 4.52891L14.9246 4.83712C15.2096 4.98498 15.4657 5.17586 15.6905 5.40606L16.1698 5.89708C16.3041 6.03465 16.4426 6.16018 16.5846 6.27325L17.102 6.68516C17.2423 6.7969 17.394 6.90233 17.5573 7.0004L18.1455 7.35313C18.5578 7.60078 18.8263 7.98391 18.9325 8.44298L19.0871 9.11212C19.0923 9.11611 19.0998 9.12157 19.11 9.12794L19.7838 9.55099C20.1846 9.8023 20.4895 10.1801 20.5971 10.6783L20.6709 11.0223L20.7454 11.3662C20.8327 11.7706 20.7983 12.1742 20.6604 12.5568L20.5338 12.9084L20.4067 13.2594C20.3561 13.3999 20.3429 13.5102 20.3463 13.5957L20.3592 13.9215L20.3727 14.2473C20.3862 14.5802 20.3357 14.9069 20.2233 15.2205L20.003 15.8352C19.9261 16.0494 19.8463 16.2611 19.7633 16.4697L19.645 16.7686L19.526 17.0668C19.4533 17.2497 19.3839 17.4404 19.3174 17.6387L19.2096 17.9586L19.1024 18.2785C18.9703 18.6723 18.7265 19.0009 18.3875 19.2412L18.1127 19.4363L17.8373 19.6309C17.7965 19.6598 17.7487 19.709 17.7026 19.809L17.3891 20.4893C17.1889 20.9234 16.8437 21.258 16.3702 21.4174L16.0379 21.5293L15.7057 21.6406C15.5319 21.6991 15.3661 21.7711 15.2077 21.8563L14.5965 22.1844C14.3545 22.3144 14.1018 22.4279 13.8395 22.5242L13.1686 22.7703C12.6329 22.9669 12.1084 22.8542 11.6821 22.5699L11 22.1152C10.9479 22.0805 10.9138 22.0668 10.8981 22.0619C10.8923 22.0602 10.8884 22.0593 10.8864 22.059L10.2219 22.1035C9.8133 22.1307 9.42167 22.0331 9.07348 21.8182L8.50629 21.4678C8.50462 21.4672 8.50146 21.4664 8.49633 21.4654C8.4818 21.4627 8.44732 21.4589 8.38734 21.4654L7.57758 21.5533C7.31315 21.582 7.01248 21.5552 6.72445 21.408C6.43117 21.2581 6.22898 21.0233 6.10102 20.7711L5.75766 20.0932C5.71446 20.008 5.67063 19.9691 5.62875 19.9443L5.32582 19.7656L5.02289 19.5875C4.7085 19.4022 4.44338 19.1556 4.23773 18.8533L3.84867 18.2815C3.71761 18.0888 3.58537 17.8922 3.45199 17.6926L3.0559 17.0996C2.80718 16.7274 2.70249 16.3026 2.73949 15.8621L2.77055 15.4965L2.80102 15.1315C2.81543 14.9602 2.81331 14.6802 2.78051 14.2695L2.74008 13.7609C2.61248 13.3419 2.80606 12.8816 3.21352 12.6875C3.66222 12.474 4.19926 12.6648 4.41293 13.1135L4.43871 13.1674L4.5102 13.3174L4.52309 13.4826L4.57465 14.126C4.61035 14.5729 4.62173 14.9662 4.59516 15.282L4.5641 15.6477L4.53363 16.0133C4.52979 16.0596 4.53698 16.0764 4.55238 16.0994L4.94848 16.6924C5.07922 16.8881 5.20931 17.0804 5.33754 17.269L5.7266 17.8414C5.78024 17.9201 5.84715 17.9839 5.93637 18.0365L6.2393 18.2152L6.54223 18.3934C6.90405 18.6066 7.17739 18.9131 7.36313 19.2793L7.53481 19.618L7.59691 19.741L7.78852 19.7199L8.1934 19.676C8.61704 19.63 9.05748 19.6925 9.45199 19.9361L10.0192 20.2865C10.049 20.3049 10.0685 20.3099 10.1024 20.3076L10.7668 20.2631C11.2281 20.2324 11.646 20.382 11.9991 20.6176L12.3401 20.8449L12.6413 21.0465L13.2196 20.8344C13.4048 20.7664 13.5795 20.6875 13.7446 20.5988L14.3557 20.2707C14.6042 20.1372 14.8634 20.0254 15.1321 19.935L15.7596 19.7234L15.9114 19.3953L16.0678 19.0555C16.2308 18.7019 16.4709 18.3934 16.7967 18.1625L17.0715 17.9674L17.3469 17.7729C17.3743 17.7534 17.3853 17.7384 17.3961 17.7061L17.6106 17.0662C17.687 16.8383 17.7677 16.6167 17.8532 16.4018L18.0911 15.8047C18.1663 15.6155 18.239 15.4228 18.309 15.2275L18.5293 14.6135C18.5637 14.5177 18.5779 14.4219 18.5739 14.3205L18.561 13.9941L18.5475 13.6684C18.5334 13.3194 18.5952 12.9773 18.7133 12.6494L18.8399 12.2979L18.967 11.9463C18.9978 11.8609 18.998 11.8004 18.9864 11.7465L18.912 11.4025L18.8434 11.0879C18.8392 11.0848 18.8342 11.0798 18.8276 11.0756L18.4907 10.8647L18.1538 10.6531C17.7549 10.4031 17.4518 10.0289 17.3381 9.53751L17.1852 8.87657L16.9245 8.71954L16.6309 8.54317C16.4023 8.40589 16.1849 8.25597 15.9805 8.09317L15.7221 7.88692L15.4631 7.68126C15.2604 7.51984 15.0667 7.34372 14.8819 7.1545L14.6422 6.90899L14.4026 6.66407C14.3081 6.56737 14.2061 6.49177 14.0955 6.43438L13.5395 6.14669L13.0461 6.30724C12.6764 6.42763 12.2917 6.42413 11.9305 6.36056L11.5332 6.29024L11.1366 6.22052C10.9951 6.19561 10.916 6.21115 10.8741 6.22579L10.577 6.3295L10.5881 6.39688L10.6959 6.41388C10.9143 6.44795 11.1397 6.53184 11.3352 6.69454C11.5323 6.85866 11.6574 7.06826 11.7272 7.28575L11.8262 7.59395L11.9164 7.87579C11.9192 7.8788 11.9229 7.88295 11.9276 7.88751C11.9603 7.919 12.0272 7.97051 12.1473 8.03399L12.7631 8.35919L12.8569 8.47052L12.8955 8.51622C13.1625 8.83277 13.1224 9.30615 12.8059 9.57325C12.5167 9.81718 12.0974 9.8044 11.8233 9.55919L11.4465 9.35997C11.0622 9.15692 10.6529 8.84704 10.4967 8.36095L10.3977 8.05274L10.3409 7.87696L10.1311 7.84356L9.79711 7.792C9.35344 7.72282 8.96739 7.46948 8.76879 7.02325L8.51918 6.46309C8.45512 6.31908 8.38522 6.1987 8.31234 6.09864L7.99008 5.65567L7.94496 5.58888C7.83515 5.41293 7.70679 5.10065 7.85356 4.74044C8.00319 4.37359 8.33489 4.23504 8.48695 4.1838L8.77875 4.08536L9.07055 3.98751C9.17679 3.9517 9.25172 3.90509 9.30785 3.8545L9.51703 3.66641L9.72563 3.47774C9.85127 3.36444 9.97272 3.24633 10.0901 3.12384L10.4803 2.7172C10.651 2.53908 10.8409 2.38243 11.0487 2.24786L11.2877 2.09259L11.5127 1.94727L11.5409 1.74513L11.5702 1.52891L11.7108 1.36251L11.7495 1.31622Z"
						fill="black"
					/>
				</svg>
				เล่นใหม่
			</button>
			<div
				href="#"
				class="text-b6 flex cursor-pointer flex-row items-center gap-1 underline"
				@click="isInfoPopupVisible = true"
			>
				<p>อ่านวิธีคำนวณคะแนนเพิ่มเติม</p>
				<img src="/img/icon-info.svg" class="h-4" />
			</div>
		</div>
		<InfoPopup
			v-if="isInfoPopupVisible"
			title="วิธีคำนวณคะแนน"
			class="fixed top-1/2 left-1/2 z-2 -translate-x-1/2 -translate-y-1/2 transform"
			content="นับคะแนนจากตัวเลือกที่คุณเลือก 10 ข้อ เทียบกับกับมติพรรคถถ้าตรงกันจะนับเป็น 1 คะแนน หรือ 10% ยกเว้นในกรณีที่เป็นมติเสียงแตก ผลการลงมติของคนในพรรคเท่ากัน จะนับเป็น 0.5 คะแนน หรือ 5%"
			@close="isInfoPopupVisible = false"
		/>
	</div>

	<!-- Outro -->
	<div class="section text-b4 flex flex-col gap-8 pt-20 pb-10 text-center">
		<p>
			แม้ร่างกฎหมายที่เราเลือกมาให้โหวต
			จะเป็นเพียงส่วนหนึ่งของประเด็นที่ถูกผลักดันในสภาตลอด 3 ปีที่ผ่านมา
			แต่ก็ชวนคิดว่าพรรคการเมืองที่คุณจะเลือก เคยได้ทำหน้าที่ตัดสินใจในมติต่าง ๆ
			อย่างที่คาดหวังไว้ไหม พร้อมทั้งให้ไอเดียคุณว่าการเลือกตั้งครั้งนี้
			จะเลือกสนับสนุนพรรคการเมืองไหนเพื่อทำหน้าที่ให้ตรงใจคุณมากขึ้น
		</p>
		<img src="/img/hearts.gif" class="mx-auto h-10" />
		<p class="text-b6 text-green-1">
			หมายเหตุ: มติพรรคในการเลือกโหวต ‘เห็นด้วย’ ‘ไม่เห็นด้วย’ หรือ ‘งดออกเสียง’
			มาจากการพิจารณาในรายละเอียดของร่างฯ กฎหมาย  มากกว่าแค่ชื่อร่างฯ กฎหมาย
			โดยสามารถศึกษารายละเอียดของแต่ละร่างได้ที่
			<a
				href="https://lis.parliament.go.th/index/search_advance.php"
				class="underline"
				>ระบบสารสนเทศด้านนิติบัญญัติ</a
			>
		</p>

		<div class="section flex flex-row gap-6">
			<div
				v-for="(project, index) in projects"
				:key="index"
				class="flex min-h-20 w-full cursor-pointer flex-col gap-4 rounded-2xl border-3 border-b-black bg-white p-6 shadow-md hover:shadow-none"
				href="project.href"
			>
				<h4 class="font-kondolar text-h10 font-bold">{{ project.title }}</h4>
				<img :src="project.imgSrc" alt="" />
			</div>
		</div>
	</div>
</template>
